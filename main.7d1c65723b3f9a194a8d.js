(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"451c956b-7b94-41f4-8472-a0b95ad49c46","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c),e.addEventListener("click",(function(t){return a(t,e)})),setTimeout((function(){e.classList.add("popup_is-visible")}),10)}function o(e){e.classList.remove("popup_is-visible"),document.removeEventListener("keydown",c),e.removeEventListener("click",a),setTimeout((function(){e.classList.remove("popup_is-opened")}),300)}var c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}},a=function(e,t){e.target===t&&o(t)};function u(e,c){var a=e.name,u=e.link,l=e.likes,s=e._id,d=e.owner,p=document.querySelector("#card-template").content,f=document.querySelector(".popup_type_delete-card"),v=f.querySelector(".popup__button"),_=p.querySelector(".card").cloneNode(!0),m=_.querySelector(".card__title"),y=_.querySelector(".card__image"),h=_.querySelector(".card__like-button"),b=_.querySelector(".card__likes-count"),S=_.querySelector(".card__delete-button");return m.textContent=a,y.src=u,y.alt=a,i(h,b,l,c),h.addEventListener("click",(function(){var e;(h.classList.contains("card__like-button_is-active")?(e=s,fetch("".concat(t.baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:t.headers}).then(n)):function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:t.headers}).then(n)}(s)).then((function(e){i(h,b,e.likes,c)})).catch((function(e){return console.error("Put like error: ",e)}))})),d._id!==c?S.remove():S.addEventListener("click",(function(){r(f);var e=function(e){e.preventDefault();var r,c=v.textContent;v.textContent="Удаление",v.disabled=!0;var a,u=0,i=function(){var e=".".repeat(3-u%3);v.textContent="Удаление".concat(e),u++};i(),r=setInterval(i,200),(a=s,fetch("".concat(t.baseUrl,"/cards/").concat(a),{method:"DELETE",headers:t.headers}).then(n)).then((function(){S.closest(".card").remove(),o(f)})).catch((function(e){return console.error("Delete card error: ",e)})).finally((function(){clearInterval(r),v.textContent=c,v.disabled=!1}))};v.removeEventListener("click",v._handler),v.addEventListener("click",e,{once:!0}),v._handler=e})),y.addEventListener("click",(function(){var e=document.querySelector(".popup__image"),t=document.querySelector(".popup__caption"),n=document.querySelector(".popup_type_image");e.src=u,e.alt=a,t.textContent=a,r(n)})),_}function i(e,t,n,r){t.textContent=n.length>0?n.length:"",n.some((function(e){return e._id===r}))?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}var l,s=function(e){return new RegExp(/^(?:(?:https?|ftp|telnet):\/\/(?:[a-z0-9_-]{1,32}(?::[a-z0-9_-]{1,32})?@)?)?(?:(?:[a-z0-9-]{1,128}\.)+(?:com|net|org|mil|edu|arpa|ru|gov|biz|info|aero|inc|name|[a-z]{2})|(?!0)(?:(?!0[^.]|255)[0-9]{1,3}\.){3}(?!0|255)[0-9]{1,3})(?:\/[a-z0-9.,_@%&?+=\~\/-]*)?(?:#[^ \'\"&<>]*)?$/i).test(e)},d=function(t,n){!function(e){return e.some((function(e){return"url"===e.type?!s(e.value):(console.log(e.validity.valid),!e.validity.valid)}))}(t)?(n.classList.remove(e.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(e.inactiveButtonClass),n.setAttribute("disabled",!0))},p=function(t,n,r){var o=t.querySelector("#input-".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r,o.classList.add(e.errorClass)},f=function(t,n){var r=t.querySelector("#input-".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""},v=function(t){t.reset(),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(e){f(t,e)}));var n=t.querySelector(e.submitButtonSelector);n.classList.add(e.inactiveButtonClass),n.removeAttribute("disabled")},_=function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);d(n,r),n.forEach((function(e){e.addEventListener("input",(function(){"url"===e.type?s(e.value)?f(t,e):p(t,e,"Введите корректный URL"):e.validity.valid?f(t,e):p(t,e,e.validationMessage),d(n,r)}))}))},m=document.querySelector(".places__list"),y=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_avatar"),S=document.querySelectorAll(".popup"),q=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__avatar-edit"),E=document.querySelectorAll(".popup__close"),k=document.querySelector(".profile__title"),x=document.querySelector(".profile__image"),g=document.querySelector(".profile__description"),A=y.querySelector(".popup__form"),U=A.querySelector(".popup__input_type_name"),B=A.querySelector(".popup__input_type_description"),T=h.querySelector(".popup__form"),I=h.querySelector(".popup__input_type_card-name"),z=h.querySelector(".popup__input_type_url"),D=b.querySelector(".popup__form"),P=b.querySelector(".popup__input_type_url");S.forEach((function(e){e.classList.add("popup_is-animated")})),function(e){e.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");t&&o(t)}))}))}(E),q.addEventListener("click",(function(){U.value=k.textContent,B.value=g.textContent,function(t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(e){f(t,e)}));var n=t.querySelector(e.submitButtonSelector);n.classList.remove(e.inactiveButtonClass),n.setAttribute("disabled",!0)}(A),r(y)})),A.addEventListener("submit",(function(e){e.preventDefault();var r,c=U.value,a=B.value,u=e.target.querySelector("button");u.textContent="Сохранение",u.disabled=!0;var i=0,l=function(){var e=".".repeat(3-i%3);u.textContent="Сохранение".concat(e),i++};l(),r=setInterval(l,200),function(e){var r=e.username,o=e.description;return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:o})}).then(n)}({username:c,description:a}).then((function(e){var t=e.name,n=e.about;k.textContent=t,g.textContent=n,o(y)})).catch((function(e){return console.error("Ошибка обновления профиля:",e)})).finally((function(){clearInterval(r),u.textContent="Сохранить",u.disabled=!1}))})),C.addEventListener("click",(function(){r(h)})),T.addEventListener("submit",(function(e){e.preventDefault();var r,c=I.value,a=z.value,i=e.target.querySelector("button");i.textContent="Сохранение",i.disabled=!0;var s=0,d=function(){var e=".".repeat(3-s%3);i.textContent="Сохранение".concat(e),s++};d(),r=setInterval(d,200),function(e){var r=e.name,o=e.link;return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:o})}).then(n)}({name:c,link:a}).then((function(e){var t=u(e,l);m.prepend(t),o(h),v(T)})).catch((function(e){return console.error("Ошибка добавления карточки:",e)})).finally((function(){clearInterval(r),i.textContent="Сохранить",i.disabled=!1}))})),L.addEventListener("click",(function(){r(b)})),D.addEventListener("submit",(function(e){e.preventDefault();var r,c=P.value,a=e.target.querySelector("button");a.textContent="Сохранение",a.disabled=!0;var u=0,i=function(){var e=".".repeat(3-u%3);a.textContent="Сохранение".concat(e),u++};i(),r=setInterval(i,200),function(e){var r=e.avatar;return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:r})}).then(n)}({avatar:c}).then((function(e){var t=e.avatar;x.src=t,o(b),v(D)})).catch((function(e){return console.error("Ошибка изменения аватара:",e)})).finally((function(){clearInterval(r),a.textContent="Сохранить",a.disabled=!1,v(D)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){_(e)}))}(e),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n).then((function(e){var t=e.name,n=e.about,r=e.avatar,o=e._id;k.textContent=t,g.textContent=n,x.src=r,l=o})).catch((function(e){return console.error("Ошибка загрузки данных пользователя:",e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n).then((function(e){e.forEach((function(e){var t=u(e,l);m.append(t)}))})).catch((function(e){return console.error("Ошибка загрузки карточек:",e)}))})();