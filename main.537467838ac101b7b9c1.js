(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"451c956b-7b94-41f4-8472-a0b95ad49c46","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c),e.addEventListener("click",(function(t){return a(t,e)})),setTimeout((function(){e.classList.add("popup_is-visible")}),10)}function o(e){e.classList.remove("popup_is-visible"),document.removeEventListener("keydown",c),e.removeEventListener("click",a),setTimeout((function(){e.classList.remove("popup_is-opened")}),300)}var c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}},a=function(e,t){e.target===t&&o(t)};function u(e,c){var a=e.name,u=e.link,s=e.likes,l=e._id,d=e.owner,p=document.querySelector("#card-template").content,_=document.querySelector(".popup_type_delete-card"),f=_.querySelector(".popup__button"),v=p.querySelector(".card").cloneNode(!0),m=v.querySelector(".card__title"),y=v.querySelector(".card__image"),h=v.querySelector(".card__like-button"),b=v.querySelector(".card__likes-count"),S=v.querySelector(".card__delete-button");return m.textContent=a,y.src=u,y.alt=a,i(h,b,s,c),h.addEventListener("click",(function(){var e;(h.classList.contains("card__like-button_is-active")?(e=l,fetch("".concat(t.baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:t.headers}).then(n)):function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:t.headers}).then(n)}(l)).then((function(e){i(h,b,e.likes,c)})).catch((function(e){return console.error("Put like error: ",e)}))})),d._id!==c?S.remove():S.addEventListener("click",(function(){r(_);var e=function(e){e.preventDefault();var r=f.textContent;f.textContent="Удаление",f.disabled=!0;var c,a=0,u=function(){var e=".".repeat(3-a%3);f.textContent="Удаление".concat(e),a++};u(),setInterval(u,200),(c=l,fetch("".concat(t.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:t.headers}).then(n)).then((function(){S.closest(".card").remove(),o(_)})).catch((function(e){return console.error("Delete card error: ",e)})).finally((function(){f.textContent=r,f.disabled=!1}))};f.removeEventListener("click",f._handler),f.addEventListener("click",e,{once:!0}),f._handler=e})),y.addEventListener("click",(function(){var e=document.querySelector(".popup__image"),t=document.querySelector(".popup__caption"),n=document.querySelector(".popup_type_image");e.src=u,e.alt=a,t.textContent=a,r(n)})),v}function i(e,t,n,r){t.textContent=n.length>0?n.length:"",n.some((function(e){return e._id===r}))?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}var s,l=function(t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(e.inactiveButtonClass),n.setAttribute("disabled",!0))},d=function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);l(n,r),n.forEach((function(o){o.addEventListener("input",(function(){o.validity.valid?function(t,n){var r=t.querySelector("#input-".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""}(t,o):function(t,n,r){var o=t.querySelector("#input-".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r,o.classList.add(e.errorClass)}(t,o,o.validationMessage),l(n,r)}))}))},p=document.querySelector(".places__list"),_=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_avatar"),m=document.querySelectorAll(".popup"),y=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__avatar-edit"),S=document.querySelectorAll(".popup__close"),q=document.querySelector(".profile__title"),C=document.querySelector(".profile__image"),L=document.querySelector(".profile__description"),E=_.querySelector(".popup__form"),k=E.querySelector(".popup__input_type_name"),x=E.querySelector(".popup__input_type_description"),g=f.querySelector(".popup__form"),A=f.querySelector(".popup__input_type_card-name"),U=f.querySelector(".popup__input_type_url"),T=v.querySelector(".popup__form"),D=v.querySelector(".popup__input_type_url");m.forEach((function(e){e.classList.add("popup_is-animated")})),function(e){e.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");t&&o(t)}))}))}(S),y.addEventListener("click",(function(){k.value=q.textContent,x.value=L.textContent,r(_)})),E.addEventListener("submit",(function(e){e.preventDefault();var r=k.value,c=x.value,a=e.target.querySelector("button");a.textContent="Сохранение",a.disabled=!0,function(e){var r=e.username,o=e.description;return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:o})}).then(n)}({username:r,description:c}).then((function(e){var t=e.name,n=e.about;q.textContent=t,L.textContent=n,o(_)})).catch((function(e){return console.error("Ошибка обновления профиля:",e)})).finally((function(){a.textContent="Сохранить",a.disabled=!1}))})),h.addEventListener("click",(function(){r(f)})),g.addEventListener("submit",(function(e){e.preventDefault();var r=A.value,c=U.value,a=e.target.querySelector("button");a.textContent="Сохранение",a.disabled=!0;var i=0,l=function(){var e=".".repeat(3-i%3);a.textContent="Сохранение".concat(e),i++};l(),setInterval(l,200),function(e){var r=e.name,o=e.link;return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:o})}).then(n)}({name:r,link:c}).then((function(e){var t=u(e,s);p.prepend(t),o(f),g.reset()})).catch((function(e){return console.error("Ошибка добавления карточки:",e)})).finally((function(){a.textContent="Сохранить",a.disabled=!1}))})),b.addEventListener("click",(function(){r(v)})),T.addEventListener("submit",(function(e){e.preventDefault();var r=D.value,c=e.target.querySelector("button");c.textContent="Сохранение...",c.disabled=!0,function(e){var r=e.avatar;return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:r})}).then(n)}({avatar:r}).then((function(e){var t=e.avatar;C.src=t,o(v),T.reset()})).catch((function(e){return console.error("Ошибка изменения аватара:",e)})).finally((function(){c.textContent="Сохранить",c.disabled=!1}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){d(e)}))}(e),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n).then((function(e){var t=e.name,n=e.about,r=e.avatar,o=e._id;q.textContent=t,L.textContent=n,C.src=r,s=o})).catch((function(e){return console.error("Ошибка загрузки данных пользователя:",e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n).then((function(e){e.forEach((function(e){var t=u(e,s);p.append(t)}))})).catch((function(e){return console.error("Ошибка загрузки карточек:",e)}))})();